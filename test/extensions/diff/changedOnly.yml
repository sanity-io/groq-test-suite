name: 'diff:changedOnly() function'
version: '>=2.0.0'

features:
  - namespaces
  - diff

documents:
  - _id: 'original'
    _type: 'document'
    a: 1
    b: 2
    alpha:
      foo: '3'
      bar: '4'
    beta:
      foo: '5'
      bar: '6'

  - _id: 'changed_1'
    _type: 'document'
    a: 1
    b: 2
    alpha:
      foo: '300'
      bar: '4'
    beta:
      foo: '5'
      bar: '6'

  - _id: 'changed_2'
    _type: 'document'
    a: 1
    b: 2
    alpha:
      foo: '300'
      bar: '4'
    beta:
      foo: '500'
      bar: '6'

tests:
  - name: 'When only the selected attributes change'
    query: |
      diff:changedAny(*[_id == 'original'][0], *[_id == 'changed_1'][0], ~selector~)
    variables:
      selector:
        - 'a'
        - '(a, b)'
        - 'alpha.foo'
        - 'alpha.(foo, bar)'
        - '(alpha, beta).foo'
    result: true

  - name: 'When no attributes have changed'
    query: |
      diff:changedAny(*[_id == 'original'][0], *[_id == 'original'][0], alpha.foo)
    result: false

  - name: 'When both selected and non-selected attributes change'
    query: |
      diff:changedAny(*[_id == 'original'][0], *[_id == 'changed_2'][0], alpha.foo)
    result: false
