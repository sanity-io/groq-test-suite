name: "Match operator"

documents:
- _id: "a"
  _type: "test"
  text: "Battle of Britain"
- _id: "b"
  _type: "test"
  text: "The Brittany Murphy Story"
- _id: "c"
  _type: "test"
  text: "Britney Ever After"

variables:
  text: '"hello world FOO-bar"'
  pattern1: '"hel*"'
  pattern2: '"fo"'
  patterns: '["hello", "foo"]'

tests:
- name: Simple match
  query: |
    *[text match "Britain"]._id
  result: [a]
- name: Simple case-insensitive match
  query: |
    *[text match "britain"]._id
  result: [a]
- name: Prefix
  query: |
    *[text match "brit*"]._id
  result: [a, b, c]
- name: Term and prefix
  query: |
    *[text match "battle brit*"]._id
  result: [a]
- name: Wildcard
  query: |
    *[text match "*britn*"]._id
  result: [c]
- name: Term and wildcard
  query: |
    *[text match "*brit* ever"]._id
  result: [c]
- name: Wildcard 2
  query: |
    *[text match "*br*tn*"]._id
  result: [c]
- name: Term and wildcard
  query: |
    *[text match "*br*tn* ever"]._id
  result: [c]

- query: |
    ~text~ match ~pattern~

  tests:
    - name: "Matching"
      result: true
      variables:
        pattern:
        - '"hello*"'
        - '"hel*"'
        - '"foo"'
        - '"bar"'
        - '"*ld"'
        - '"h*l*o"'
        - '"foo-bar"'
        - '"hel* bar"'
        - '"hello bar*"'
        - '["hel*", "bar"]'
        - '["hello", "foo"]'

    - name: "Non-matching"
      result: false
      variables:
        pattern:
        - '"fo"'
        - '"hell"'
        - '"fo bar"'

- name: "Multiple text"
  variables:
    abc: '"abc"'
  query: |
    ~text~ match ~abc~
  tests:
  - {variables: {text: '["abc"]'}, result: true}
  - {variables: {text: '["abc", "def"]'}, result: true}
  - {variables: {text: '["def"]'}, result: false}
  - {variables: {text: '[]'}, result: false}

- name: "Unsupported RHS"
  variables:
    expr:
    - '123'
    - '{}'
    - '[1]'
    - '["1", 2]'
    - '123'
    - 'true'
    - 'false'
    - 'null'
  query: |
    "" match ~expr~
  result: false

- name: "Unsupported LHS"
  variables:
    expr:
    - '{}'
    - '[1]'
    - '123'
    - 'true'
    - 'false'
    - 'null'
  query: |
    ~expr~ match ""
  result: false
